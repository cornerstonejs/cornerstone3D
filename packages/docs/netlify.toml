# https://www.netlify.com/docs/netlify-toml-reference/

[build]
  # Directory (relative to root of your repo) that contains the deploy-ready
  # HTML files and assets generated by the build. If a base directory has
  # been specified, include it in the publish directory path.
  base = "packages/docs/"
  command = "yarn run docs:ci"
  publish = "build"

  # Rebuild if anything changes, don't scope to this folder
  ignore = "git diff --quiet $CACHED_COMMIT_REF $COMMIT_REF . ../../"

# COMMENT: NODE_VERSION in root `.nvmrc` takes priority
# COMMENT: Why we specify YARN_FLAGS: https://www.netlify.com/docs/build-gotchas/#yarn
[build.environment]
  NODE_VERSION = "14.15.0"
  YARN_VERSION = "1.22.5"
  NETLIFY_USE_YARN = "true"
  YARN_FLAGS = "--no-ignore-optional --pure-lockfile"
  NODE_OPTIONS = "--max_old_space_size=16384"

# COMMENT: This a rule for Single Page Applications
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200

# COMMENT: For sharedArrayBuffer, see https://developer.chrome.com/blog/enabling-shared-array-buffer/
[[headers]]
  # Define which paths this specific [[headers]] block will cover.
  for = "/*"
    [headers.values]
    Cross-Origin-Embedder-Policy = "require-corp"
    Cross-Origin-Opener-Policy =  "same-origin"

# Attempt to speed up docusaurus builds by persisting the webpack cache
# across deploys. This is done in the main docusaurus repo: https://github.com/facebook/docusaurus/blob/cc0bceab9c1678303f6237f5526753edc1b12fc3/website/netlify.toml#L22
[[plugins]]
package = "netlify-plugin-cache"
  [plugins.inputs]
  paths = [
    "node_modules/.cache/webpack",
  ]
