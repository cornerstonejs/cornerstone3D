/*! cornerstone-wado-image-loader - v0.8.1 - 2016-02-03 | (c) 2014 Chris Hafey | https://github.com/chafey/cornerstoneWADOImageLoader */
"undefined"==typeof cornerstone&&(cornerstone={}),"undefined"==typeof cornerstoneWADOImageLoader&&(cornerstoneWADOImageLoader={internal:{options:{beforeSend:function(a){}},multiFrameCacheHack:{}}}),function(a){"use strict";function b(b,c,d){var e=b.uint16("x00280006");0===e?a.convertRGBColorByPixel(c,d):a.convertRGBColorByPlane(c,d)}function c(c,d,e){var f=d.uint16("x00280010"),g=d.uint16("x00280011"),h=d.string("x00280004");c.height=f,c.width=g;var i=c.getContext("2d"),j=i.createImageData(g,f),k=$.Deferred();try{if("RGB"===h)b(d,e,j.data);else if("YBR_RCT"===h)b(d,e,j.data);else if("YBR_ICT"===h)b(d,e,j.data);else if("PALETTE COLOR"===h)a.convertPALETTECOLOR(e,j.data,d);else if("YBR_FULL_422"===h)a.convertYBRFull(e,j.data);else{if("YBR_FULL"!==h)throw"no color space conversion for photometric interpretation "+h;a.convertYBRFull(e,j.data)}return k.resolve(j),k}catch(l){return k.reject(l),k}}a.convertColorSpace=c}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b,c){for(var d=c.int16("x00281101",0),e=c.int16("x00281101",1),f=c.int16("x00281101",2),g=8===f?0:8,h=c.byteArray.buffer,i=new Uint16Array(h,c.elements.x00281201.dataOffset,d),j=new Uint16Array(h,c.elements.x00281202.dataOffset,d),k=new Uint16Array(h,c.elements.x00281203.dataOffset,d),l=c.uint16("x00280010")*c.uint16("x00280011"),m=0,n=0,o=0;l>o;++o){var p=a[m++];e>p?p=0:p>e+d-1?p=d-1:p-=e,b[n++]=i[p]>>g,b[n++]=j[p]>>g,b[n++]=k[p]>>g,b[n++]=255}}a.convertPALETTECOLOR=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++)b[e++]=a[d++],b[e++]=a[d++],b[e++]=a[d++],b[e++]=255}a.convertRGBColorByPixel=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: rgbBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: rgbBuffer length must be divisible by 3";for(var c=a.length/3,d=0,e=0;c>e;e++)for(var f=0,g=c,h=2*c,e=0;c>e;e++)b[d++]=a[f++],b[d++]=a[g++],b[d++]=a[h++],b[d++]=255}a.convertRGBColorByPlane=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a,b){if(void 0===a)throw"decodeRGB: ybrBuffer must not be undefined";if(a.length%3!==0)throw"decodeRGB: ybrBuffer length must be divisble by 3";for(var c=a.length/3,d=0,e=0,f=0;c>f;f++){var g=a[d++],h=a[d++],i=a[d++];b[e++]=g+1.402*(i-128),b[e++]=g-.34414*(h-128)-.71414*(i-128),b[e++]=g+1.772*(h-128),b[e++]=255}}a.convertYBRFull=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b){a.internal.options=b}a.configure=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c,d,e){void 0===d&&(d=0);var f=b.string("x00280004"),g=a.isColorImage(f);return g===!1?a.makeGrayscaleImage(c,b,d,e):a.makeColorImage(c,b,d,e)}a.createImageObject=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=a.uint16("x00280010"),d=a.uint16("x00280011"),e=dicomParser.readEncapsulatedPixelData(a,a.elements.x7fe00010,b),f=new JpxImage;f.parse(e);var g=f.width,h=f.height;if(g!==d)throw"JPEG2000 decoder returned width of "+g+", when "+d+" is expected";if(h!==c)throw"JPEG2000 decoder returned width of "+h+", when "+c+" is expected";var i=f.tiles.length;if(1!==i)throw"JPEG2000 decoder returned a tileCount of "+i+", when 1 is expected";var j=f.tiles[0],k=j.items;return k}c.decodeJPEG2000=d}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){var c=a.elements.x7fe00010,d=a.uint16("x00280010"),e=a.uint16("x00280011"),f=a.uint16("x00280100"),g=dicomParser.readEncapsulatedPixelData(a,c,b),h=new JpegImage;return h.parse(g),8===f?h.getData(e,d):16===f?h.getData16(e,d):void 0}c.decodeJPEGBaseline=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return c(String.fromCharCode.apply(null,Array.prototype.slice.apply(new Uint8Array(a))))}function c(a){var b;try{return decodeURIComponent(escape(a))}catch(c){if(b=c,b instanceof URIError)return a;throw b}}function d(a,c,d){var e=$.Deferred(),f=c.uint16("x00280010"),g=c.uint16("x00280011");a.height=f,a.width=g;var h=dicomParser.readEncapsulatedPixelData(c,c.elements.x7fe00010,d),i=new Blob([h],{type:"image/jpeg"}),j=new FileReader;return void 0===j.readAsBinaryString?j.readAsArrayBuffer(i):j.readAsBinaryString(i),j.onload=function(){var c=new Image;c.onload=function(){var b=a.getContext("2d");b.drawImage(this,0,0);var c=b.getImageData(0,0,g,f);e.resolve(c)},c.onerror=function(a){e.reject(a)},void 0===j.readAsBinaryString?c.src="data:image/jpeg;base64,"+window.btoa(b(j.result)):c.src="data:image/jpeg;base64,"+window.btoa(j.result)},e}function e(a){var b=a.string("x00020010"),c=a.uint16("x00280100");return 8===c&&"1.2.840.10008.1.2.4.50"===b?!0:void 0}a.decodeJPEGBaseline8Bit=d,a.isJPEGBaseline8Bit=e}(cornerstoneWADOImageLoader),function(a){function b(a,b){var c=a.elements.x7fe00010,d=a.uint16("x00280100"),e=a.uint16("x00280103"),f=dicomParser.readEncapsulatedPixelData(a,c,b),g=8>=d?1:2,h=new jpeg.lossless.Decoder,i=h.decode(f.buffer,f.byteOffset,f.length,g);return 0===e?2===g?new Uint16Array(i.buffer):new Uint8Array(i.buffer):new Int16Array(i.buffer)}a.decodeJPEGLossless=b}(cornerstoneWADOImageLoader),function(a){function b(b,e){var f,g=b.uint16("x00280010"),h=b.uint16("x00280011"),i=b.uint16("x00280002"),j=b.elements.x7fe00010,k=dicomParser.readEncapsulatedPixelData(b,j,e),l=a.getPixelFormat(b),m=h*g;return 1===l?(f=new ArrayBuffer(m*i),c(k,f,m,i),new Uint8Array(f)):2===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Uint16Array(f)):3===l?(f=new ArrayBuffer(m*i*2),d(k,f,m),new Int16Array(f)):void 0}function c(a,b,c,d){for(var e=new DataView(a.buffer,a.byteOffset),f=new DataView(a.buffer,a.byteOffset),g=new DataView(b),h=0,i=e.getInt32(0,!0),j=0;i>j;++j){h=j;var k=e.getInt32(4*(j+1),!0),l=e.getInt32(4*(j+2),!0);0===l&&(l=a.length);for(var m=c*i;l>k;){var n=f.getInt8(k++);if(n>=0&&127>=n)for(var o=0;n+1>o&&m>h;++o)g.setInt8(h,f.getInt8(k++)),h+=d;else if(-1>=n&&n>=-127)for(var p=f.getInt8(k++),q=0;-n+1>q&&m>h;++q)g.setInt8(h,p),h+=d}}}function d(a,b,c){for(var d=new DataView(a.buffer,a.byteOffset),e=new DataView(a.buffer,a.byteOffset),f=new DataView(b),g=d.getInt32(0,!0),h=0;g>h;++h){var i=0,j=0===h?1:0,k=d.getInt32(4*(h+1),!0),l=d.getInt32(4*(h+2),!0);for(0===l&&(l=a.length);l>k;){var m=e.getInt8(k++);if(m>=0&&127>=m)for(var n=0;m+1>n&&c>i;++n)f.setInt8(2*i+j,e.getInt8(k++)),i++;else if(-1>=m&&m>=-127)for(var o=e.getInt8(k++),p=0;-m+1>p&&c>i;++p)f.setInt8(2*i+j,o),i++}}}a.decodeRLE=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(b,c){var d=b.string("x00020010");if("1.2.840.10008.1.2"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.1"===d)return a.extractUncompressedPixels(b,c);if("1.2.840.10008.1.2.4.90"===d)return a.decodeJPEG2000(b,c);if("1.2.840.10008.1.2.4.91"===d)return a.decodeJPEG2000(b,c);if("1.2.840.10008.1.2.5"===d)return a.decodeRLE(b,c);if("1.2.840.10008.1.2.4.50"===d)return a.decodeJPEGBaseline(b,c);if("1.2.840.10008.1.2.4.51"===d)return a.decodeJPEGBaseline(b,c);if("1.2.840.10008.1.2.4.57"===d)return a.decodeJPEGLossless(b,c);if("1.2.840.10008.1.2.4.70"===d)return a.decodeJPEGLossless(b,c);throw"no decoder for transfer syntax "+d}a.decodeTransferSyntax=b}(cornerstoneWADOImageLoader);var ColorSpace={Unkown:0,Grayscale:1,AdobeRGB:2,RGB:3,CYMK:4},JpegImage=function(){"use strict";function a(){}function b(a,b){for(var c,d,e=0,f=[],g=16;g>0&&!a[g-1];)g--;f.push({children:[],index:0});var h,i=f[0];for(c=0;g>c;c++){for(d=0;d<a[c];d++){for(i=f.pop(),i.children[i.index]=b[e];i.index>0;)i=f.pop();for(i.index++,f.push(i);f.length<=c;)f.push(h={children:[],index:0}),i.children[i.index]=h.children,i=h;e++}g>c+1&&(f.push(h={children:[],index:0}),i.children[i.index]=h.children,i=h)}return f[0].children}function c(a,b,c){return 64*((a.blocksPerLine+1)*b+c)}function d(a,b,d,e,f,g,i,j,k){function l(){if(H>0)return H--,G>>H&1;if(G=a[b++],255==G){var c=a[b++];if(c)throw"unexpected marker: "+(G<<8|c).toString(16)}return H=7,G>>>7}function m(a){for(var b,c=a;null!==(b=l());){if(c=c[b],"number"==typeof c)return c;if("object"!=typeof c)throw"invalid huffman sequence"}return null}function n(a){for(var b=0;a>0;){var c=l();if(null===c)return;b=b<<1|c,a--}return b}function o(a){var b=n(a);return b>=1<<a-1?b:b+(-1<<a)+1}function p(a,b){var c=m(a.huffmanTableDC),d=0===c?0:o(c);a.blockData[b]=a.pred+=d;for(var e=1;64>e;){var f=m(a.huffmanTableAC),g=15&f,i=f>>4;if(0!==g){e+=i;var j=h[e];a.blockData[b+j]=o(g),e++}else{if(15>i)break;e+=16}}}function q(a,b){var c=m(a.huffmanTableDC),d=0===c?0:o(c)<<k;a.blockData[b]=a.pred+=d}function r(a,b){a.blockData[b]|=l()<<k}function s(a,b){if(I>0)return void I--;for(var c=g,d=i;d>=c;){var e=m(a.huffmanTableAC),f=15&e,j=e>>4;if(0!==f){c+=j;var l=h[c];a.blockData[b+l]=o(f)*(1<<k),c++}else{if(15>j){I=n(j)+(1<<j)-1;break}c+=16}}}function t(a,b){for(var c=g,d=i,e=0;d>=c;){var f=h[c];switch(J){case 0:var j=m(a.huffmanTableAC),p=15&j;if(e=j>>4,0===p)15>e?(I=n(e)+(1<<e),J=4):(e=16,J=1);else{if(1!==p)throw"invalid ACn encoding";w=o(p),J=e?2:3}continue;case 1:case 2:a.blockData[b+f]?a.blockData[b+f]+=l()<<k:(e--,0===e&&(J=2==J?3:0));break;case 3:a.blockData[b+f]?a.blockData[b+f]+=l()<<k:(a.blockData[b+f]=w<<k,J=0);break;case 4:a.blockData[b+f]&&(a.blockData[b+f]+=l()<<k)}c++}4===J&&(I--,0===I&&(J=0))}function u(a,b,d,e,f){var g=d/D|0,h=d%D,i=g*a.v+e,j=h*a.h+f,k=c(a,i,j);b(a,k)}function v(a,b,d){var e=d/a.blocksPerLine|0,f=d%a.blocksPerLine,g=c(a,e,f);b(a,g)}var w,x,y,z,A,B,C,D=(d.precision,d.samplesPerLine,d.scanLines,d.mcusPerLine),E=d.progressive,F=(d.maxH,d.maxV,b),G=0,H=0,I=0,J=0,K=e.length;C=E?0===g?0===j?q:r:0===j?s:t:p;var L,M,N=0;M=1==K?e[0].blocksPerLine*e[0].blocksPerColumn:D*d.mcusPerColumn,f||(f=M);for(var O,P;M>N;){for(y=0;K>y;y++)e[y].pred=0;if(I=0,1==K)for(x=e[0],B=0;f>B;B++)v(x,C,N),N++;else for(B=0;f>B;B++){for(y=0;K>y;y++)for(x=e[y],O=x.h,P=x.v,z=0;P>z;z++)for(A=0;O>A;A++)u(x,C,N,z,A);N++}if(H=0,L=a[b]<<8|a[b+1],65280>=L)throw"marker was not found";if(!(L>=65488&&65495>=L))break;b+=2}return b-F}function e(a,b,c){var d,e,f,g,h,q,r,s,t,u,v=a.quantizationTable;for(u=0;64>u;u++)c[u]=a.blockData[b+u]*v[u];for(u=0;8>u;++u){var w=8*u;0!==c[1+w]||0!==c[2+w]||0!==c[3+w]||0!==c[4+w]||0!==c[5+w]||0!==c[6+w]||0!==c[7+w]?(d=o*c[0+w]+128>>8,e=o*c[4+w]+128>>8,f=c[2+w],g=c[6+w],h=p*(c[1+w]-c[7+w])+128>>8,s=p*(c[1+w]+c[7+w])+128>>8,q=c[3+w]<<4,r=c[5+w]<<4,t=d-e+1>>1,d=d+e+1>>1,e=t,t=f*n+g*m+128>>8,f=f*m-g*n+128>>8,g=t,t=h-r+1>>1,h=h+r+1>>1,r=t,t=s+q+1>>1,q=s-q+1>>1,s=t,t=d-g+1>>1,d=d+g+1>>1,g=t,t=e-f+1>>1,e=e+f+1>>1,f=t,t=h*l+s*k+2048>>12,h=h*k-s*l+2048>>12,s=t,t=q*j+r*i+2048>>12,q=q*i-r*j+2048>>12,r=t,c[0+w]=d+s,c[7+w]=d-s,c[1+w]=e+r,c[6+w]=e-r,c[2+w]=f+q,c[5+w]=f-q,c[3+w]=g+h,c[4+w]=g-h):(t=o*c[0+w]+512>>10,c[0+w]=t,c[1+w]=t,c[2+w]=t,c[3+w]=t,c[4+w]=t,c[5+w]=t,c[6+w]=t,c[7+w]=t)}for(u=0;8>u;++u){var x=u;0!==c[8+x]||0!==c[16+x]||0!==c[24+x]||0!==c[32+x]||0!==c[40+x]||0!==c[48+x]||0!==c[56+x]?(d=o*c[0+x]+2048>>12,e=o*c[32+x]+2048>>12,f=c[16+x],g=c[48+x],h=p*(c[8+x]-c[56+x])+2048>>12,s=p*(c[8+x]+c[56+x])+2048>>12,q=c[24+x],r=c[40+x],t=d-e+1>>1,d=d+e+1>>1,e=t,t=f*n+g*m+2048>>12,f=f*m-g*n+2048>>12,g=t,t=h-r+1>>1,h=h+r+1>>1,r=t,t=s+q+1>>1,q=s-q+1>>1,s=t,t=d-g+1>>1,d=d+g+1>>1,g=t,t=e-f+1>>1,e=e+f+1>>1,f=t,t=h*l+s*k+2048>>12,h=h*k-s*l+2048>>12,s=t,t=q*j+r*i+2048>>12,q=q*i-r*j+2048>>12,r=t,c[0+x]=d+s,c[56+x]=d-s,c[8+x]=e+r,c[48+x]=e-r,c[16+x]=f+q,c[40+x]=f-q,c[24+x]=g+h,c[32+x]=g-h):(t=o*c[u+0]+8192>>14,c[0+x]=t,c[8+x]=t,c[16+x]=t,c[24+x]=t,c[32+x]=t,c[40+x]=t,c[48+x]=t,c[56+x]=t)}for(u=0;64>u;++u){var y=b+u,z=c[u];z=z<=-2056/a.bitConversion?0:z>=2024/a.bitConversion?255/a.bitConversion:z+2056/a.bitConversion>>4,a.blockData[y]=z}}function f(a,b){for(var d=b.blocksPerLine,f=b.blocksPerColumn,g=new Int32Array(64),h=0;f>h;h++)for(var i=0;d>i;i++){var j=c(b,h,i);e(b,j,g)}return b.blockData}function g(a){return 0>=a?0:a>=255?255:0|a}var h=new Int32Array([0,1,8,16,9,2,3,10,17,24,32,25,18,11,4,5,12,19,26,33,40,48,41,34,27,20,13,6,7,14,21,28,35,42,49,56,57,50,43,36,29,22,15,23,30,37,44,51,58,59,52,45,38,31,39,46,53,60,61,54,47,55,62,63]),i=4017,j=799,k=3406,l=2276,m=1567,n=3784,o=5793,p=2896;return a.prototype={load:function(a){var b=function(a){this.parse(a),this.onload&&this.onload()}.bind(this);if(a.indexOf("data:")>-1){for(var c=a.indexOf("base64,")+7,d=atob(a.substring(c)),e=new Uint8Array(d.length),f=d.length-1;f>=0;f--)e[f]=d.charCodeAt(f);b(d)}else{var g=new XMLHttpRequest;g.open("GET",a,!0),g.responseType="arraybuffer",g.onload=function(){var a=new Uint8Array(g.response);b(a)}.bind(this),g.send(null)}},parse:function(a){function c(){var b=a[k]<<8|a[k+1];return k+=2,b}function e(){var b=c(),d=a.subarray(k,k+b-2);return k+=d.length,d}function g(a){for(var b=Math.ceil(a.samplesPerLine/8/a.maxH),c=Math.ceil(a.scanLines/8/a.maxV),d=0;d<a.components.length;d++){N=a.components[d];var e=Math.ceil(Math.ceil(a.samplesPerLine/8)*N.h/a.maxH),f=Math.ceil(Math.ceil(a.scanLines/8)*N.v/a.maxV),g=b*N.h,h=c*N.v,i=64*h*(g+1);N.blockData=new Int16Array(i),N.blocksPerLine=e,N.blocksPerColumn=f}a.mcusPerLine=b,a.mcusPerColumn=c}var i,j,k=0,l=(a.length,null),m=null,n=[],o=[],p=[],q=c();if(65496!=q)throw"SOI not found";for(q=c();65497!=q;){var r,s,t;switch(q){case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:case 65534:var u=e();65504===q&&74===u[0]&&70===u[1]&&73===u[2]&&70===u[3]&&0===u[4]&&(l={version:{major:u[5],minor:u[6]},densityUnits:u[7],xDensity:u[8]<<8|u[9],yDensity:u[10]<<8|u[11],thumbWidth:u[12],thumbHeight:u[13],thumbData:u.subarray(14,14+3*u[12]*u[13])}),65518===q&&65===u[0]&&100===u[1]&&111===u[2]&&98===u[3]&&101===u[4]&&0===u[5]&&(m={version:u[6],flags0:u[7]<<8|u[8],flags1:u[9]<<8|u[10],transformCode:u[11]});break;case 65499:for(var v=c(),w=v+k-2;w>k;){var x=a[k++],y=new Int32Array(64);if(x>>4===0)for(s=0;64>s;s++){var z=h[s];y[z]=a[k++]}else{if(x>>4!==1)throw"DQT: invalid table spec";for(s=0;64>s;s++){var A=h[s];y[A]=c()}}n[15&x]=y}break;case 65472:case 65473:case 65474:if(i)throw"Only single frame JPEGs supported";c(),i={},i.extended=65473===q,i.progressive=65474===q,i.precision=a[k++],i.scanLines=c(),i.samplesPerLine=c(),i.components=[],i.componentIds={};var B,C=a[k++],D=0,E=0;for(r=0;C>r;r++){B=a[k];var F=a[k+1]>>4,G=15&a[k+1];F>D&&(D=F),G>E&&(E=G);var H=a[k+2];t=i.components.push({h:F,v:G,quantizationTable:n[H],quantizationTableId:H,bitConversion:255/((1<<i.precision)-1)}),i.componentIds[B]=t-1,k+=3}i.maxH=D,i.maxV=E,g(i);break;case 65476:var I=c();for(r=2;I>r;){var J=a[k++],K=new Uint8Array(16),L=0;for(s=0;16>s;s++,k++)L+=K[s]=a[k];var M=new Uint8Array(L);for(s=0;L>s;s++,k++)M[s]=a[k];r+=17+L,(J>>4===0?p:o)[15&J]=b(K,M)}break;case 65501:c(),j=c();break;case 65498:var N,O=(c(),a[k++]),P=[];for(r=0;O>r;r++){var Q=i.componentIds[a[k++]];N=i.components[Q];var R=a[k++];N.huffmanTableDC=p[R>>4],N.huffmanTableAC=o[15&R],P.push(N)}var S=a[k++],T=a[k++],U=a[k++],V=d(a,k,i,P,j,S,T,U>>4,15&U);k+=V;break;default:if(255==a[k-3]&&a[k-2]>=192&&a[k-2]<=254){k-=3;break}throw"unknown JPEG marker "+q.toString(16)}q=c()}switch(this.width=i.samplesPerLine,this.height=i.scanLines,this.jfif=l,this.adobe=m,this.components=[],i.components.length){case 1:this.colorspace=ColorSpace.Grayscale;break;case 3:this.adobe?this.colorspace=ColorSpace.AdobeRGB:this.colorspace=ColorSpace.RGB;break;case 4:this.colorspace=ColorSpace.CYMK;break;default:this.colorspace=ColorSpace.Unknown}for(var r=0;r<i.components.length;r++){var N=i.components[r];N.quantizationTable||null===N.quantizationTableId||(N.quantizationTable=n[N.quantizationTableId]),this.components.push({output:f(i,N),scaleX:N.h/i.maxH,scaleY:N.v/i.maxV,blocksPerLine:N.blocksPerLine,blocksPerColumn:N.blocksPerColumn,bitConversion:N.bitConversion})}},getData16:function(a,b){if(1!==this.components.length)throw"Unsupported color mode";var d,e,f,g,h,i,j=this.width/a,k=this.height/b,l=0,m=this.components.length,n=a*b*m,o=new Uint16Array(n),p=new Uint16Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(i=0;m>i;i++){d=this.components[i];for(var q,r,s=d.blocksPerLine,t=d.blocksPerColumn,u=s<<3,v=0,w=0;t>w;w++)for(var x=w<<3,y=0;s>y;y++){var z=c(d,w,y),l=0,A=y<<3;for(q=0;8>q;q++){var v=(x+q)*u;for(r=0;8>r;r++)p[v+A+r]=d.output[z+l++]}}e=d.scaleX*j,f=d.scaleY*k,l=i;var B,C,D;for(h=0;b>h;h++)for(g=0;a>g;g++)C=0|h*f,B=0|g*e,D=C*u+B,o[l]=p[D],l+=m}return o},getData:function(a,b){var d,e,f,h,i,j,k,l,m,n,o,p,q,r,s,t=this.width/a,u=this.height/b,v=0,w=this.components.length,x=a*b*w,y=new Uint8Array(x),z=new Uint8Array((this.components[0].blocksPerLine<<3)*this.components[0].blocksPerColumn*8);for(j=0;w>j;j++){d=this.components[j];for(var A,B,C=d.blocksPerLine,D=d.blocksPerColumn,E=C<<3,F=0,G=0;D>G;G++)for(var H=G<<3,I=0;C>I;I++){var J=c(d,G,I),v=0,K=I<<3;for(A=0;8>A;A++){var F=(H+A)*E;for(B=0;8>B;B++)z[F+K+B]=d.output[J+v++]*d.bitConversion}}e=d.scaleX*t,f=d.scaleY*u,v=j;var L,M,N;for(i=0;b>i;i++)for(h=0;a>h;h++)M=0|i*f,L=0|h*e,N=M*E+L,y[v]=z[N],v+=w}switch(w){case 1:case 2:break;case 3:if(s=!0,this.adobe&&this.adobe.transformCode?s=!0:"undefined"!=typeof this.colorTransform&&(s=!!this.colorTransform),s)for(j=0;x>j;j+=w)k=y[j],l=y[j+1],m=y[j+2],p=g(k-179.456+1.402*m),q=g(k+135.459-.344*l-.714*m),r=g(k-226.816+1.772*l),y[j]=p,y[j+1]=q,y[j+2]=r;break;case 4:if(!this.adobe)throw"Unsupported color mode (4 components)";if(s=!1,this.adobe&&this.adobe.transformCode?s=!0:"undefined"!=typeof this.colorTransform&&(s=!!this.colorTransform),s)for(j=0;x>j;j+=w)k=y[j],l=y[j+1],m=y[j+2],n=g(434.456-k-1.402*m),o=g(119.541-k+.344*l+.714*m),k=g(481.816-k-1.772*l),y[j]=n,y[j+1]=o,y[j+2]=k;break;default:throw"Unsupported color mode"}return y}},a}();!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.jpeg=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ComponentSpec=d.lossless.ComponentSpec||function(){this.hSamp=0,this.quantTableSel=0,this.vSamp=0};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.ComponentSpec)},{}],2:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||function(a,b,c){this.buffer=new DataView(a,b,c),this.index=0},d.lossless.DataStream.prototype.get16=function(){var a=this.buffer.getUint16(this.index,!1);return this.index+=2,a},d.lossless.DataStream.prototype.get8=function(){var a=this.buffer.getUint8(this.index);return this.index+=1,a};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.DataStream)},{}],3:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.HuffmanTable=d.lossless.HuffmanTable||("undefined"!=typeof a?a("./huffman-table.js"):null),d.lossless.QuantizationTable=d.lossless.QuantizationTable||("undefined"!=typeof a?a("./quantization-table.js"):null),d.lossless.ScanHeader=d.lossless.ScanHeader||("undefined"!=typeof a?a("./scan-header.js"):null),d.lossless.FrameHeader=d.lossless.FrameHeader||("undefined"!=typeof a?a("./frame-header.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null),d.lossless.Decoder=d.lossless.Decoder||function(a,b){this.buffer=a,this.frame=new d.lossless.FrameHeader,this.huffTable=new d.lossless.HuffmanTable,this.quantTable=new d.lossless.QuantizationTable,this.scan=new d.lossless.ScanHeader,this.DU=d.lossless.Utils.createArray(10,4,64),this.HuffTab=d.lossless.Utils.createArray(4,2,12800),this.IDCT_Source=[],this.nBlock=[],this.acTab=d.lossless.Utils.createArray(10,1),this.dcTab=d.lossless.Utils.createArray(10,1),this.qTab=d.lossless.Utils.createArray(10,1),this.marker=0,this.markerIndex=0,this.numComp=0,this.restartInterval=0,this.selection=0,this.xDim=0,this.yDim=0,this.xLoc=0,this.yLoc=0,this.numBytes=0,this.outputData=null,"undefined"!=typeof b&&(this.numBytes=b)},d.lossless.Decoder.IDCT_P=[0,5,40,16,45,2,7,42,21,56,8,61,18,47,1,4,41,23,58,13,32,24,37,10,63,17,44,3,6,43,20,57,15,34,29,48,53,26,39,9,60,19,46,22,59,12,33,31,50,55,25,36,11,62,14,35,28,49,52,27,38,30,51,54],d.lossless.Decoder.TABLE=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63],d.lossless.Decoder.MAX_HUFFMAN_SUBTREE=50,d.lossless.Decoder.MSB=2147483648,d.lossless.Decoder.prototype.decompress=function(a,b,c){return this.decode(a,b,c).buffer},d.lossless.Decoder.prototype.decode=function(a,b,c,e){var f,g,h,i,j=0,k=[],l=[],m=[];if("undefined"!=typeof a&&(this.buffer=a),"undefined"!=typeof e&&(this.numBytes=e),this.stream=new d.lossless.DataStream(this.buffer,b,c),this.buffer=null,this.xLoc=0,this.yLoc=0,f=this.stream.get16(),65496!==f)throw new Error("Not a JPEG file");for(f=this.stream.get16();f>>4!==4092||65476===f;){switch(f){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,d.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(f>>8!==255)throw new Error("ERROR: format throw new IOException! (decode)")}f=this.stream.get16()}if(65472>f||f>65479)throw new Error("ERROR: could not handle arithmetic code!");this.frame.read(this.stream),f=this.stream.get16();do{for(;65498!==f;){switch(f){case 65476:this.huffTable.read(this.stream,this.HuffTab);break;case 65484:throw new Error("Program doesn't support arithmetic coding. (format throw new IOException)");case 65499:this.quantTable.read(this.stream,d.lossless.Decoder.TABLE);break;case 65501:this.restartInterval=this.readNumber();break;case 65504:case 65505:case 65506:case 65507:case 65508:case 65509:case 65510:case 65511:case 65512:case 65513:case 65514:case 65515:case 65516:case 65517:case 65518:case 65519:this.readApp();break;case 65534:this.readComment();break;default:if(f>>8!==255)throw new Error("ERROR: format throw new IOException! (Parser.decode)")}f=this.stream.get16()}switch(this.precision=this.frame.precision,this.components=this.frame.components,this.numBytes||(this.numBytes=parseInt(this.precision/8)),this.scan.read(this.stream),this.numComp=this.scan.numComp,this.selection=this.scan.selection,1===this.numBytes?3===this.numComp?(this.getter=this.getValueRGB,this.setter=this.setValueRGB,this.output=this.outputRGB):(this.getter=this.getValue8,this.setter=this.setValue8,this.output=this.outputSingle):(this.getter=this.getValue16,this.setter=this.setValue16,this.output=this.outputSingle),this.selection){case 2:this.selector=this.select2;break;case 3:this.selector=this.select3;break;case 4:this.selector=this.select4;break;case 5:this.selector=this.select5;break;case 6:this.selector=this.select6;break;case 7:this.selector=this.select7;break;default:this.selector=this.select1}for(this.scanComps=this.scan.components,this.quantTables=this.quantTable.quantTables,g=0;g<this.numComp;g+=1)h=this.scanComps[g].scanCompSel,this.qTab[g]=this.quantTables[this.components[h].quantTableSel],this.nBlock[g]=this.components[h].vSamp*this.components[h].hSamp,this.dcTab[g]=this.HuffTab[this.scanComps[g].dcTabSel][0],this.acTab[g]=this.HuffTab[this.scanComps[g].acTabSel][1];for(this.xDim=this.frame.dimX,this.yDim=this.frame.dimY,this.outputData=new DataView(new ArrayBuffer(this.xDim*this.yDim*this.numBytes*this.numComp)),j+=1;;){for(l[0]=0,m[0]=0,g=0;10>g;g+=1)k[g]=1<<this.precision-1;if(0===this.restartInterval){for(f=this.decodeUnit(k,l,m);0===f&&this.xLoc<this.xDim&&this.yLoc<this.yDim;)this.output(k),f=this.decodeUnit(k,l,m);break}for(i=0;i<this.restartInterval&&(f=this.decodeUnit(k,l,m),this.output(k),0===f);i+=1);if(0===f&&(0!==this.markerIndex?(f=65280|this.marker,this.markerIndex=0):f=this.stream.get16()),!(f>=65488&&65495>=f))break}65500===f&&1===j&&(this.readNumber(),f=this.stream.get16())}while(65497!==f&&this.xLoc<this.xDim&&this.yLoc<this.yDim&&0===j);return this.outputData},d.lossless.Decoder.prototype.decodeUnit=function(a,b,c){return 1==this.numComp?this.decodeSingle(a,b,c):3==this.numComp?this.decodeRGB(a,b,c):-1},d.lossless.Decoder.prototype.select1=function(a){return this.getPreviousX(a)},d.lossless.Decoder.prototype.select2=function(a){return this.getPreviousY(a)},d.lossless.Decoder.prototype.select3=function(a){return this.getPreviousXY(a)},d.lossless.Decoder.prototype.select4=function(a){return this.getPreviousX(a)+this.getPreviousY(a)-this.getPreviousXY(a)},d.lossless.Decoder.prototype.select5=function(a){return this.getPreviousX(a)+(this.getPreviousY(a)-this.getPreviousXY(a)>>1)},d.lossless.Decoder.prototype.select6=function(a){return this.getPreviousY(a)+(this.getPreviousX(a)-this.getPreviousXY(a)>>1)},d.lossless.Decoder.prototype.select7=function(a){return(this.getPreviousX(a)+this.getPreviousY(a))/2},d.lossless.Decoder.prototype.decodeRGB=function(a,b,c){var e,f,g,h,i,j,k,l;for(a[0]=this.selector(0),a[1]=this.selector(1),a[2]=this.selector(2),i=0;i<this.numComp;i+=1)for(h=this.qTab[i],f=this.acTab[i],g=this.dcTab[i],j=0;j<this.nBlock[i];j+=1){for(k=0;k<this.IDCT_Source.length;k+=1)this.IDCT_Source[k]=0;if(e=this.getHuffmanValue(g,b,c),e>=65280)return e;for(a[i]=this.IDCT_Source[0]=a[i]+this.getn(c,e,b,c),this.IDCT_Source[0]*=h[0],l=1;64>l;l+=1){if(e=this.getHuffmanValue(f,b,c),e>=65280)return e;if(l+=e>>4,0===(15&e)){if(e>>4===0)break}else this.IDCT_Source[d.lossless.Decoder.IDCT_P[l]]=this.getn(c,15&e,b,c)*h[l]}}return 0},d.lossless.Decoder.prototype.decodeSingle=function(a,b,c){var d,e;for(a[0]=this.selector(),e=0;e<this.nBlock[0];e+=1){if(d=this.getHuffmanValue(this.dcTab[0],b,c),d>=65280)return d;a[0]+=this.getn(a,d,b,c)}return 0},d.lossless.Decoder.prototype.getHuffmanValue=function(a,b,c){var e,f,g;if(g=65535,c[0]<8?(b[0]<<=8,f=this.stream.get8(),255===f&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),b[0]|=f):c[0]-=8,e=a[b[0]>>c[0]],0!==(e&d.lossless.Decoder.MSB)){if(0!==this.markerIndex)return this.markerIndex=0,65280|this.marker;b[0]&=g>>16-c[0],b[0]<<=8,f=this.stream.get8(),255===f&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),b[0]|=f,e=a[256*(255&e)+(b[0]>>c[0])],c[0]+=8}if(c[0]+=8-(e>>8),c[0]<0)throw new Error("index="+c[0]+" temp="+b[0]+" code="+e+" in HuffmanValue()");return c[0]<this.markerIndex?(this.markerIndex=0,65280|this.marker):(b[0]&=g>>16-c[0],255&e)},d.lossless.Decoder.prototype.getn=function(a,b,c,d){var e,f,g,h,i;if(f=1,g=-1,h=65535,0===b)return 0;if(16===b)return a[0]>=0?-32768:32768;if(d[0]-=b,d[0]>=0){if(d[0]<this.markerIndex&&!this.isLastPixel())return this.markerIndex=0,(65280|this.marker)<<8;e=c[0]>>d[0],c[0]&=h>>16-d[0]}else{if(c[0]<<=8,i=this.stream.get8(),255===i&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),c[0]|=i,d[0]+=8,d[0]<0){if(0!==this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;c[0]<<=8,i=this.stream.get8(),255===i&&(this.marker=this.stream.get8(),0!==this.marker&&(this.markerIndex=9)),c[0]|=i,d[0]+=8}if(d[0]<0)throw new Error("index="+d[0]+" in getn()");if(d[0]<this.markerIndex)return this.markerIndex=0,(65280|this.marker)<<8;e=c[0]>>d[0],c[0]&=h>>16-d[0]}return f<<b-1>e&&(e+=(g<<b)+1),e},d.lossless.Decoder.prototype.getPreviousX=function(a){return this.xLoc>0?this.getter(this.yLoc*this.xDim+this.xLoc-1,a):this.yLoc>0?this.getPreviousY(a):1<<this.frame.precision-1},d.lossless.Decoder.prototype.getPreviousXY=function(a){return this.xLoc>0&&this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc-1,a):this.getPreviousY(a)},d.lossless.Decoder.prototype.getPreviousY=function(a){return this.yLoc>0?this.getter((this.yLoc-1)*this.xDim+this.xLoc,a):this.getPreviousX(a)},d.lossless.Decoder.prototype.isLastPixel=function(){return this.xLoc===this.xDim-1&&this.yLoc===this.yDim-1},d.lossless.Decoder.prototype.outputSingle=function(a){this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(this.yLoc*this.xDim+this.xLoc,a[0]),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},d.lossless.Decoder.prototype.outputRGB=function(a){var b=this.yLoc*this.xDim+this.xLoc;this.xLoc<this.xDim&&this.yLoc<this.yDim&&(this.setter(b,a[0],0),this.setter(b,a[1],1),this.setter(b,a[2],2),this.xLoc+=1,this.xLoc>=this.xDim&&(this.yLoc+=1,this.xLoc=0))},d.lossless.Decoder.prototype.setValue16=function(a,b){this.outputData.setInt16(2*a,b,!0)},d.lossless.Decoder.prototype.getValue16=function(a){return this.outputData.getInt16(2*a,!0)},d.lossless.Decoder.prototype.setValue8=function(a,b){this.outputData.setInt8(a,b)},d.lossless.Decoder.prototype.getValue8=function(a){return this.outputData.getInt8(a)},d.lossless.Decoder.prototype.setValueRGB=function(a,b,c){this.outputData.setUint8(3*a+c,b)},d.lossless.Decoder.prototype.getValueRGB=function(a,b){return this.outputData.getUint8(3*a+b)},d.lossless.Decoder.prototype.readApp=function(){var a=0,b=this.stream.get16();for(a+=2;b>a;)this.stream.get8(),a+=1;return b},d.lossless.Decoder.prototype.readComment=function(){var a,b="",c=0;for(a=this.stream.get16(),c+=2;a>c;)b+=this.stream.get8(),c+=1;return b},d.lossless.Decoder.prototype.readNumber=function(){var a=this.stream.get16();if(4!==a)throw new Error("ERROR: Define number format throw new IOException [Ld!=4]");return this.stream.get16()};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.Decoder)},{"./data-stream.js":2,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-header.js":9,"./utils.js":10}],4:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ComponentSpec=d.lossless.ComponentSpec||("undefined"!=typeof a?a("./component-spec.js"):null),d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.FrameHeader=d.lossless.FrameHeader||function(){this.components=[],this.dimX=0,this.dimY=0,this.numComp=0,this.precision=0},d.lossless.FrameHeader.prototype.read=function(a){var b,c,e,f,g=0;for(b=a.get16(),g+=2,this.precision=a.get8(),g+=1,this.dimY=a.get16(),g+=2,this.dimX=a.get16(),g+=2,this.numComp=a.get8(),g+=1,c=1;c<=this.numComp;c+=1){if(g>b)throw new Error("ERROR: frame format error");if(e=a.get8(),g+=1,g>=b)throw new Error("ERROR: frame format error [c>=Lf]");f=a.get8(),g+=1,this.components[e]||(this.components[e]=new d.lossless.ComponentSpec),this.components[e].hSamp=f>>4,this.components[e].vSamp=15&f,this.components[e].quantTableSel=a.get8(),g+=1}if(g!==b)throw new Error("ERROR: frame format error [Lf!=count]");return 1};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.FrameHeader)},{"./component-spec.js":1,"./data-stream.js":2}],5:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null),d.lossless.HuffmanTable=d.lossless.HuffmanTable||function(){
this.l=d.lossless.Utils.createArray(4,2,16),this.th=[],this.v=d.lossless.Utils.createArray(4,2,16,200),this.tc=d.lossless.Utils.createArray(4,2),this.tc[0][0]=0,this.tc[1][0]=0,this.tc[2][0]=0,this.tc[3][0]=0,this.tc[0][1]=0,this.tc[1][1]=0,this.tc[2][1]=0,this.tc[3][1]=0,this.th[0]=0,this.th[1]=0,this.th[2]=0,this.th[3]=0},d.lossless.HuffmanTable.MSB=2147483648,d.lossless.HuffmanTable.prototype.read=function(a,b){var c,d,e,f,g,h,i=0;for(c=a.get16(),i+=2;c>i;){if(d=a.get8(),i+=1,e=15&d,e>3)throw new Error("ERROR: Huffman table ID > 3");if(f=d>>4,f>2)throw new Error("ERROR: Huffman table [Table class > 2 ]");for(this.th[e]=1,this.tc[e][f]=1,g=0;16>g;g+=1)this.l[e][f][g]=a.get8(),i+=1;for(g=0;16>g;g+=1)for(h=0;h<this.l[e][f][g];h+=1){if(i>c)throw new Error("ERROR: Huffman table format error [count>Lh]");this.v[e][f][g][h]=a.get8(),i+=1}}if(i!==c)throw new Error("ERROR: Huffman table format error [count!=Lf]");for(g=0;4>g;g+=1)for(h=0;2>h;h+=1)0!==this.tc[g][h]&&this.buildHuffTable(b[g][h],this.l[g][h],this.v[g][h]);return 1},d.lossless.HuffmanTable.prototype.buildHuffTable=function(a,b,c){var e,f,g,h,i,j;for(f=256,g=0,h=0;8>h;h+=1)for(i=0;i<b[h];i+=1)for(j=0;f>>h+1>j;j+=1)a[g]=c[h][i]|h+1<<8,g+=1;for(h=1;256>g;h+=1,g+=1)a[g]=h|d.lossless.HuffmanTable.MSB;for(e=1,g=0,h=8;16>h;h+=1)for(i=0;i<b[h];i+=1){for(j=0;f>>h-7>j;j+=1)a[256*e+g]=c[h][i]|h+1<<8,g+=1;if(g>=256){if(g>256)throw new Error("ERROR: Huffman table error(1)!");g=0,e+=1}}};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.HuffmanTable)},{"./data-stream.js":2,"./utils.js":10}],6:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ComponentSpec=d.lossless.ComponentSpec||("undefined"!=typeof a?a("./component-spec.js"):null),d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.Decoder=d.lossless.Decoder||("undefined"!=typeof a?a("./decoder.js"):null),d.lossless.FrameHeader=d.lossless.FrameHeader||("undefined"!=typeof a?a("./frame-header.js"):null),d.lossless.HuffmanTable=d.lossless.HuffmanTable||("undefined"!=typeof a?a("./huffman-table.js"):null),d.lossless.QuantizationTable=d.lossless.QuantizationTable||("undefined"!=typeof a?a("./quantization-table.js"):null),d.lossless.ScanComponent=d.lossless.ScanComponent||("undefined"!=typeof a?a("./scan-component.js"):null),d.lossless.ScanHeader=d.lossless.ScanHeader||("undefined"!=typeof a?a("./scan-header.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null);var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d)},{"./component-spec.js":1,"./data-stream.js":2,"./decoder.js":3,"./frame-header.js":4,"./huffman-table.js":5,"./quantization-table.js":7,"./scan-component.js":8,"./scan-header.js":9,"./utils.js":10}],7:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.Utils=d.lossless.Utils||("undefined"!=typeof a?a("./utils.js"):null),d.lossless.QuantizationTable=d.lossless.QuantizationTable||function(){this.precision=[],this.tq=[],this.quantTables=d.lossless.Utils.createArray(4,64),this.tq[0]=0,this.tq[1]=0,this.tq[2]=0,this.tq[3]=0},d.lossless.QuantizationTable.enhanceQuantizationTable=function(a,b){var c;for(c=0;8>c;c+=1)a[b[0+c]]*=90,a[b[32+c]]*=90,a[b[16+c]]*=118,a[b[48+c]]*=49,a[b[40+c]]*=71,a[b[8+c]]*=126,a[b[56+c]]*=25,a[b[24+c]]*=106;for(c=0;8>c;c+=1)a[b[0+8*c]]*=90,a[b[4+8*c]]*=90,a[b[2+8*c]]*=118,a[b[6+8*c]]*=49,a[b[5+8*c]]*=71,a[b[1+8*c]]*=126,a[b[7+8*c]]*=25,a[b[3+8*c]]*=106;for(c=0;64>c;c+=1)a[c]>>=6},d.lossless.QuantizationTable.prototype.read=function(a,b){var c,e,f,g,h=0;for(c=a.get16(),h+=2;c>h;){if(e=a.get8(),h+=1,f=15&e,f>3)throw new Error("ERROR: Quantization table ID > 3");if(this.precision[f]=e>>4,0===this.precision[f])this.precision[f]=8;else{if(1!==this.precision[f])throw new Error("ERROR: Quantization table precision error");this.precision[f]=16}if(this.tq[f]=1,8===this.precision[f]){for(g=0;64>g;g+=1){if(h>c)throw new Error("ERROR: Quantization table format error");this.quantTables[f][g]=a.get8(),h+=1}d.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[f],b)}else{for(g=0;64>g;g+=1){if(h>c)throw new Error("ERROR: Quantization table format error");this.quantTables[f][g]=a.get16(),h+=2}d.lossless.QuantizationTable.enhanceQuantizationTable(this.quantTables[f],b)}}if(h!==c)throw new Error("ERROR: Quantization table error [count!=Lq]");return 1};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.QuantizationTable)},{"./data-stream.js":2,"./utils.js":10}],8:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.ScanComponent=d.lossless.ScanComponent||function(){this.acTabSel=0,this.dcTabSel=0,this.scanCompSel=0};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.ScanComponent)},{}],9:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.DataStream=d.lossless.DataStream||("undefined"!=typeof a?a("./data-stream.js"):null),d.lossless.ScanComponent=d.lossless.ScanComponent||("undefined"!=typeof a?a("./scan-component.js"):null),d.lossless.ScanHeader=d.lossless.ScanHeader||function(){this.ah=0,this.al=0,this.numComp=0,this.selection=0,this.spectralEnd=0,this.components=[]},d.lossless.ScanHeader.prototype.read=function(a){var b,c,e,f=0;for(b=a.get16(),f+=2,this.numComp=a.get8(),f+=1,c=0;c<this.numComp;c+=1){if(this.components[c]=new d.lossless.ScanComponent,f>b)throw new Error("ERROR: scan header format error");this.components[c].scanCompSel=a.get8(),f+=1,e=a.get8(),f+=1,this.components[c].dcTabSel=e>>4,this.components[c].acTabSel=15&e}if(this.selection=a.get8(),f+=1,this.spectralEnd=a.get8(),f+=1,e=a.get8(),this.ah=e>>4,this.al=15&e,f+=1,f!==b)throw new Error("ERROR: scan header format error [count!=Ns]");return 1};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.ScanHeader)},{"./data-stream.js":2,"./scan-component.js":8}],10:[function(a,b,c){"use strict";var d=d||{};d.lossless=d.lossless||{},d.lossless.Utils=d.lossless.Utils||{},d.lossless.Utils.createArray=function(a){var b=new Array(a||0),c=a;if(arguments.length>1)for(var e=Array.prototype.slice.call(arguments,1);c--;)b[a-1-c]=d.lossless.Utils.createArray.apply(this,e);return b};var e=typeof b;"undefined"!==e&&b.exports&&(b.exports=d.lossless.Utils)},{}]},{},[6])(6)}),function(a,b,c){"use strict";function d(a,b){var d=c.getPixelFormat(a),e=a.elements.x7fe00010,f=a.uint16("x00280010"),g=a.uint16("x00280011"),h=a.uint16("x00280002"),i=e.dataOffset,j=g*f*h,k=0;return 1===d?(k=i+b*j,new Uint8Array(a.byteArray.buffer,k,j)):2===d?(k=i+b*j*2,new Uint16Array(a.byteArray.buffer,k,j)):3===d?(k=i+b*j*2,new Int16Array(a.byteArray.buffer,k,j)):void 0}c.extractUncompressedPixels=d}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=65535,c=-32768,d=a.length,e=a,f=0;d>f;f++){var g=e[f];b=Math.min(b,g),c=Math.max(c,g)}return{min:b,max:c}}a.getMinMax=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.uint16("x00280103"),c=a.uint16("x00280100");return 0===b&&8===c?1:0===b&&16===c?2:1===b&&16===c?3:void 0}a.getPixelFormat=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=a.string("x00280030");if(b&&b.length>0){var c=b.split("\\");return{row:parseFloat(c[0]),column:parseFloat(c[1])}}return{row:void 0,column:void 0}}a.getPixelSpacing=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={intercept:0,slope:1};return a.elements.x00281052&&a.elements.x00281053&&(b.intercept=a.floatString("x00281052"),b.slope=a.floatString("x00281053")),b}a.getRescaleSlopeAndIntercept=b}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b={windowCenter:void 0,windowWidth:void 0};return a.elements.x00281050&&a.elements.x00281051&&(b.windowCenter=a.floatString("x00281050"),b.windowWidth=a.floatString("x00281051")),b}a.getWindowWidthAndCenter=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(b){var d,e=a.Deferred(),f=b.indexOf(":"),g=b.substring(f+1),h=g.indexOf("frame=");if(-1!==h){var i=g.substr(h+6);d=parseInt(i),g=g.substr(0,h-1)}if(void 0!==d&&c.internal.multiFrameCacheHack.hasOwnProperty(g)){var j=c.internal.multiFrameCacheHack[g],k=c.createImageObject(j,b,d);return k.then(function(a){e.resolve(a)},function(a){e.reject(a)}),e}var l=parseInt(g),m=c.fileManager.get(l);if(void 0===m)return e.reject("unknown file index "+g),e;var n=new FileReader;return n.onload=function(a){var f=a.target.result,h=new Uint8Array(f),i=dicomParser.parseDicom(h);if(void 0!==d){var i=c.internal.multiFrameCacheHack[g],j=c.createImageObject(i,b,d);return j.then(function(a){e.resolve(a)},function(a){e.reject(a)}),e}var j=c.createImageObject(i,b,d);j.then(function(a){e.resolve(a)},function(){e.reject()})},n.readAsArrayBuffer(m),e}b.registerImageLoader("dicomfile",d)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"dicomfile:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.fileManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a){function b(a,b,c){if(c+a.length>b.length)return!1;for(var d=c,e=0;e<a.length;e++)if(a[e]!==b[d++])return!1;return!0}function c(a){for(var b=new Uint8Array(a.length),c=0,d=a.length;d>c;c++)b[c]=a.charCodeAt(c);return b}function d(a,d,e){e=e||0;for(var f=c(d),g=e;g<a.length;g++)if(f[0]===a[g]&&b(f,a,g))return g;return-1}a.internal.findIndexOfString=d}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){for(var b=0;b<a.length;b++)if("--"===a[b].substr(0,2))return a[b];return void 0}function c(a){for(var b=0;b<a.length;b++)if("Content-Type:"===a[b].substr(0,13))return a[b].substr(13).trim();return void 0}function d(a,b,c){b=b||0,c=c||a.length-b;for(var d="",e=b;b+c>e;e++)d+=String.fromCharCode(a[e]);return d}a.internal.getImageFrame=function(e,f){f=f||"application/octet-stream";var g=$.Deferred(),h=new XMLHttpRequest;return h.responseType="arraybuffer",h.open("get",e,!0),h.setRequestHeader("Accept","multipart/related;type="+f),h.onreadystatechange=function(e){if(4===h.readyState)if(200===h.status){var f=h.response,i=new Uint8Array(h.response),j=a.internal.findIndexOfString(i,"\n\r\n");-1===j&&g.reject("invalid response - no multipart mime header");var k=d(i,0,j),l=k.split("\r\n"),m=b(l);m||g.reject("invalid response - no boundary marker");var n=j+4,o=a.internal.findIndexOfString(i,m,n);-1===o&&g.reject("invalid response - terminating boundary not found");var p=o-n-1;g.resolve({contentType:c(l),arrayBuffer:f,offset:n,length:p})}else g.reject(h.response)},h.send(),g}}(cornerstoneWADOImageLoader),function(a){"use strict";function b(a){var b=f.push(a);return"wadors:"+(b-1)}function c(a){return f[a]}function d(a){f[a]=void 0}function e(){f=[]}var f=[];a.imageManager={add:b,get:c,remove:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d){var e=a.Deferred(),f=d.substring(7),g=c.imageManager.get(f);if(void 0===g)return e.reject("unknown imageId"),e;var h;return c.internal.getImageFrame(g.uri,h).then(function(a){var f;16===g.instance.bitsAllocated?f=0===g.instance.pixelRepresentation?new Uint16Array(a.arrayBuffer,a.offset,a.length/2):new Int16Array(a.arrayBuffer,a.offset,a.length/2):8===g.instance.bitsAllocated&&(f=new Uint8Array(a.arrayBuffer,a.offset,a.length));var h=c.getMinMax(f);g.imageId=d,g.minPixelValue=h.min,g.maxPixelValue=h.max,g.render=b.renderGrayscaleImage,g.getPixelData=function(){return f},e.resolve(g)}).fail(function(a){e.reject(a)}),e}b.registerImageLoader("wadors",d)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return void 0!==f[a]}function c(b){if(f[b]){var c=$.Deferred();return f[b].cacheCount++,c.resolve(f[b].dataSet),c}if(g[b])return g[b];var d=a.internal.xhrRequest(b);return g[b]=d,d.then(function(a){f[b]={dataSet:a,cacheCount:1},delete g[b]},function(){}).always(function(){delete g[b]}),d}function d(a){f[a]&&(f[a].cacheCount--,0===f[a].cacheCount&&delete f[a])}function e(){f={},g={}}var f={},g={};a.dataSetCacheManager={isLoaded:b,load:c,unload:d,purge:e}}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b,c=a.indexOf(":"),d=a.substring(c+1),e=d.indexOf("frame=");if(-1!==e){var f=d.substr(e+6);b=parseInt(f),d=d.substr(0,e-1)}return{url:d,frame:b}}function e(a){a.decache=function(){var b=d(a.imageId);c.dataSetCacheManager.unload(b.url)}}function f(b,d,f,g){var h=a.Deferred();return b.then(function(a){var b=c.createImageObject(a,d,f,g);b.then(function(a){e(a),h.resolve(a)},function(a){h.reject(a)})},function(a){h.reject(a)}),h}function g(b){var g=d(b);if(c.dataSetCacheManager.isLoaded(g.url))return f(c.dataSetCacheManager.load(g.url),b,g.frame,g.url);if(void 0!==g.frame)return f(c.dataSetCacheManager.load(g.url),b,g.frame,g.url);var h=a.Deferred(),i=c.internal.xhrRequest(g.url,b);return i.then(function(a){var d=c.createImageObject(a,b,g.frame);d.then(function(a){e(a),h.resolve(a)},function(a){h.reject(a)})},function(a){h.reject(a)}),h}b.registerImageLoader("dicomweb",g),b.registerImageLoader("wadouri",g)}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";function b(a){return"RGB"===a||"PALETTE COLOR"===a||"YBR_FULL"===a||"YBR_FULL_422"===a||"YBR_PARTIAL_422"===a||"YBR_PARTIAL_420"===a||"YBR_RCT"===a||"YBR_ICT"===a?!0:!1}a.isColorImage=b}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a,b){if(c.isJPEGBaseline8Bit(a)===!0)return c.decodeJPEGBaseline8Bit(f,a,b);var d=c.decodeTransferSyntax(a,b);return c.convertColorSpace(f,a,d)}function e(e,h,i,j){var k=c.getPixelSpacing(h),l=h.uint16("x00280010"),m=h.uint16("x00280011"),n=c.getRescaleSlopeAndIntercept(h),o=h.byteArray.length,p=c.getWindowWidthAndCenter(h);g=void 0;var q,r=a.Deferred();try{q=d(h,i)}catch(s){return r.reject(s),r}return q.then(function(a){function c(){return a.data}function d(){return a}function i(){if(g===e)return f;f.height=l,f.width=m;var b=f.getContext("2d");return b.putImageData(a,0,0),g=e,f}var q={imageId:e,minPixelValue:0,maxPixelValue:255,slope:n.slope,intercept:n.intercept,windowCenter:p.windowCenter,windowWidth:p.windowWidth,render:b.renderColorImage,getPixelData:c,getImageData:d,getCanvas:i,rows:l,columns:m,height:l,width:m,color:!0,columnPixelSpacing:k.column,rowPixelSpacing:k.row,data:h,invert:!1,sizeInBytes:o,sharedCacheKey:j};void 0===q.windowCenter&&(q.windowWidth=255,q.windowCenter=128),r.resolve(q)},function(a){r.reject(a)}),r}var f=document.createElement("canvas"),g="";c.makeColorImage=e}($,cornerstone,cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(a){var b=c.getPixelFormat(a);if(1===b)return 1;if(2===b||3===b)return 2;throw"unknown pixel format"}function e(a,b,c){var d=c.uint16("x00283002",0);0===d&&(d=65535);var e=0;e=0===b?c.uint16("x00283002",1):c.int16("x00283002",1);for(var f=c.uint16("x00283002",2),g={id:"1",firstValueMapped:e,numBitsPerEntry:f,lut:[]},h=0;d>h;h++)0===b?g.lut[h]=c.uint16("x00283006",h):g.lut[h]=c.int16("x00283006",h);return g}function f(f,g,h,i){function j(){return r}var k,l=a.Deferred(),m=c.getPixelSpacing(g),n=g.uint16("x00280010"),o=g.uint16("x00280011"),p=c.getRescaleSlopeAndIntercept(g);try{k=d(g)}catch(q){return l.reject(q),l}var r,s=g.byteArray.length,t=g.string("x00280004"),u="MONOCHROME1"===t,v=c.getWindowWidthAndCenter(g);try{r=c.decodeTransferSyntax(g,h)}catch(w){return l.reject(w),l}var x=c.getMinMax(r),y={imageId:f,minPixelValue:x.min,maxPixelValue:x.max,slope:p.slope,intercept:p.intercept,windowCenter:v.windowCenter,windowWidth:v.windowWidth,render:b.renderGrayscaleImage,getPixelData:j,rows:n,columns:o,height:n,width:o,color:!1,columnPixelSpacing:m.column,rowPixelSpacing:m.row,data:g,invert:u,sizeInBytes:s,sharedCacheKey:i},z=g.uint16("x00280103");if(g.elements.x00283000&&(y.modalityLUT=e(y,z,g.elements.x00283000.items[0].dataSet)),g.elements.x00283010&&(z=0,y.minPixelValue*y.slope+y.intercept<0&&(z=1),y.voiLUT=e(y,z,g.elements.x00283010.items[0].dataSet)),void 0===y.windowCenter){var A=y.maxPixelValue*y.slope+y.intercept,B=y.minPixelValue*y.slope+y.intercept;y.windowWidth=A-B,y.windowCenter=(A+B)/2}return l.resolve(y),l}c.makeGrayscaleImage=f}($,cornerstone,cornerstoneWADOImageLoader),function(a){"use strict";a.version="0.8.1"}(cornerstoneWADOImageLoader),function(a,b,c){"use strict";function d(d,e){var f=a.Deferred(),g=new XMLHttpRequest;return g.open("get",d,!0),g.responseType="arraybuffer",c.internal.options.beforeSend(g),g.onreadystatechange=function(a){if(4===g.readyState)if(200===g.status){var b=g.response,c=new Uint8Array(b),d=dicomParser.parseDicom(c);f.resolve(d)}else f.reject(g.response)},g.onprogress=function(c){if(c.lengthComputable){var d=c.loaded,f=c.total,g=Math.round(d/f*100);a(b).trigger("CornerstoneImageLoadProgress",{imageId:e,loaded:d,total:f,percentComplete:g})}},g.send(),f}c.internal.xhrRequest=d}($,cornerstone,cornerstoneWADOImageLoader);